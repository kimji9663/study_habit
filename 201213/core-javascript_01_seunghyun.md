# 코어 자바스크립트 책 내용 정리 1

## 1. 데이터 타입

- 자바스크립트 데이터엔 크게 **기본형**과 **참조형**이 있다.

### 기본형

- Number
- String
- Boolean
- Null
- Undefined
- Symbol (es6)

### 참조형

- Object (나머지는 Object 하위 분류)
- Array
- Function
- Date
- RegExp
- Map (es6)
- WeakMap (es6)
- Set (es6)
- WeakSet (es6)

### 변수

- 변경가능한 데이터를 담을 수 있는 공간.

### 식별자

- 변수의 이름

### 데이터를 할당하는 방법

#### 기본형 할당

1. 변수를 선언하면 컴퓨터는 메모리의 빈 공간에 식별자를 저장하고, 그 공간의 값은 undefined로 지정한다.
2. 이후 그 변수에 기본형 데이터를 할당하려고 할 때 별도의 공간에 데이터를 저장하고, 그 공간의 주소를 변수의 값 영역에 할당한다.

#### 참조형 할당

1. 참조형 데이터 내부 프로퍼티들을 위한 변수 영역을 별도로 확보해서 확보된 주소를 변수에 연결한다.
2. 앞서 확보된 변수 영역에 각 프로퍼티의 식별자를 저장 후 각 데이터의 공간을 별도의 공간에 저장해서 그 주소를 식별자들과 매칭시킨다.

#### 기본형과 참조형의 차이가 생긴 이유

- 참조형은 여러 개의 프로퍼티(변수)를 모은 '그룹'이기 때문.

### 참조형 데이터를 불변값으로 사용하는 방법

- 내부 프로퍼티를 일일이 복사하면 된다. (깊은 복사)
- 라이브러리 사용(ex: immer.js)

### Null과 Undefined의 차이

#### undefined

- 변수에 값이 없음을 의미

#### Null

- 사용자가 명시적으로 "없음"을 표현하기 위해 대입한 값

</br>

## 2. 실행 컨택스트

- **실행할 코드에 환경 정보들을 모아놓은 객체**이다.
- 실행 컨텍스트는 전역 공간에서 자동으로 생성되는 **전역 컨텍스트**와 **eval 및 함수 실행에 의한 컨텍스트** 가 있다.
  > evel은 evil(악마)이라고도 불리며, 현재는 잘 쓰지 않는다고 한다.
- 실행 컨텍스트 객체는 활성화되는 시점에 VariableEnvironment와 LexicalEnvironment, ThisBinding의 세 가지 정보를 수집한다.

### 참고사항

#### 1) 스택

- 우물처럼 출입구가 하나 뿐인 데이터 구조
- 비어있는 스택에 데이터를 a,b,c,d 순으로 넣으면 꺼낼 때는 반대로 d,c,b,a 역순으로 꺼낼 수 있다.

#### 2) 큐

- 양쪽이 열려있느 파이프와 같은 데이터 구조
- 보통 한 쪽은 입력만, 다른 한 쪽은 출력만 담당한다.
- 비어있는 큐에 데이터를 a,b,c,d 순으로 저장하면 꺼낼 때도 a,b,c,d 순으로 꺼낸다.

### 대략적인 자바스크립트 코드 실행 순서

1. 전역 컨텍스트가 콜 스택에 담김
    - 일반적인 실행 컨텍스트와 특별히 다를 것은 없으나 코드 내부에서 실행 명령이 없어도 브라우저에서 자동으로 실행된다.
    - 자바스크립트 코드가 실행되는 순간 전역 컨텍스트가 실행된다고 보면 된다.
  
2. 전역 컨텍스트와 관련된 코드를 순차적으로 진행하다가 자바스크립트 코드에서 호출된 함수를 만나게 되면 전역 컨텍스트의 진행을 멈추고 해당 함수의 실행 컨텍스트를 생성한 후 콜스택에 담는다.
3. 호출된 함수 코드 실행이 진행되고 더 이상 진행할 것이 없으면 콜스택에서 삭제한다.
4. 아까 멈추었던 전역 컨텍스트의 진행을 계속 이어나간다.
5. 전역 컨텍스트의 코드 실행이 끝나면 콜 스택에 제거된다.
6. 콜스택엔 더 이상 아무것도 남지않게 되며 자바스크립트 실행을 종료한다.

### 1) VariableEnvironment

- 실행 컨텍스트가 생성될 때 현재 컨텍스트 내 식별자들에 대한 정보, 외부 환경에 대한 정보가 담긴다.
- LexicalEnvironment의 스냅샷으로 변경사항은 적용되지 않음.
- environmentRecord와 outer-environmentReference로 구성되어 있음.(LexicalEnvironment도 마찬가지)

### 2) LexicalEnvironment

- 처음엔 VariableEnviroment와 같은 정보를 담고 있으나 변경사항이 실시간으로 반영된다.

#### enviromentRecord

- 컨텍스트를 구성하는 함수에 지정된 매개변수 식별자, 선언한 함수가 있을 경우 그 함수 자체, var로 선언된 변수의 식별자 등의 정보가 담겨있다.
- 코드 전체를 처음부터 끝까지 쭉 훓어나가며 순서대로 수집힌다.
- 변수 정보를 수집하는 과정을 모두 마쳤더라도 아직 실행 컨텍스트가 관여할 코드들은 실행하기 전 상태.(코드 실행 전에 해당 컨텍스트 환경 내 선언된 변수만 알게된 상태)
- 호이스팅을 통해 변수를 파악.

#### outerEnvironmentReference

- 해당 함수가 선언된 위치의 LexicalEnvironment를 참조한다.
- 코드 상에서 어떤 변수에 접근하려고 하면 현재 LexicalEnvironment를 참조해서 발견되면 그 값을 반환하고 없으면 함수 선언 시점의 LexicalEnviroment를 참조하여 값을 찾는 과정을 거침.
- 이렇게 전역 컨텍스트의 LexicalEnviroment까지 참조해보고 없으면 에러 표시.
- 여러 스코프 상에 같은 식별자를 선언한 경우 스코프 체인 상에서 가장 먼저 발견된 식별자에만 접근 가능.

#### 스코프 체인

- 식별자 유효범위를 내부에서부터 바깥으로 차례대로 검색하는 과정

#### 호이스팅

- 코드 해석을 위해 environmentRecord의 수집 과정을 추상화한 개념
- 실행 컨텍스트가 관여하는 코드 집단의 최상단으로 이들을 '끌어올린다'고 해석됨.
- let, const 변수 선언방식은 호이스팅 x

1. var 변수
   - 변수와 값이 동시에 선언된 경우 선언부만 끌어올린다.

2. 함수
   - 함수선언식일 경우 해당 함수를 통째로 끌어올린다.(함수 내부 코드까지 전부)
   - 함수표현식일 경우 함수 선언부만 var 변수로 만들어서 끌어올린다.

#### 전역 변수

- 전역 컨텍스트의 LexicalEnvironment에 담긴 변수

#### 지역 변수

- 함수에 의해 생성된 실행 컨텍스트의 변수

</br>

## 3. This

- 전역 공간에서 this는 전역 객체를 가리킨다. (브라우저에서는 window, Node에서는 Global을 가리킴)
- 어떤 함수를 메서드로써 호출한 경우 this는 메서드 호출 주체(메서드 명 앞의 객체)를 참조한다.
- 어떤 함수를 함수로써 호출한 경우 this는 전역 객체를 가리킨다.
- 콜백 함수 내부에서의 this는 해당 콜백 함수의 제어권을 넘겨받은 함수가 정의한 바에 따르며, 정의하지 않은 경우엔 전역 객체를 참조한다.
- 생성자 함수에서의 this는 생성될 인스턴스를 참조한다.

### 명시적 this 바인딩

- call, apply 메서드는 this를 명시적으로 지정하면서 함수 또는 메서드를 호출한다.
- bind 메서드는 this 및 함수에 넘길 인수를 일부 지정해서 새로운 함수를 만든다.
- 요소를 순회하면서 콜백 함수를 반복 호출하는 내용의 일부 메서드는 별도의 인자로 this를 받기도 한다.

</br>

## 4. 콜백 함수

- 콜백 함수는 다른 코드에 인자로 넘겨줌으로써 그 제어권도 함께 위임한 함수이다.
- 제어권을 넘겨받은 코드는 다음과 같은 제어권을 가진다.
    1. 콜백 함수를 호출하는 시점을 스스로 판단해서 실행한다.
    2. 콜백 함수를 호출할 때 인자로 넘겨줄 값들 및 그 순서가 정해져 있는데 이 순서를 따르지 않고 코드를 작성하면 엉뚱한 결과를 가져온다.

- 콜백 함수의 this가 무엇을 바라보도록 할지가 정해져 있는 경우도 있다. 정하지 않은 경우엔 전역 객체를 참조한다.
- 사용자 임의로 this를 바꾸고 시을 경우 bind를 사용하면 된다.
- 어떤 함수에 인자로 메서드를 전달하더라도 이는 결국 함수로써 실행된다.
- 비동기 제어를 위해 콜백함수를 사용하면 콜백지옥에 빠지기 쉽다. -> promise, generator, async/await가 좋은 대체안
